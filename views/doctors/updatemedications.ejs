<form id="updateMedForm">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">

    <label>Name</label>
    <input type="text" name="name">

    <label>Description</label>
    <textarea name="description"></textarea>

    <label>Side Effects</label>
    <textarea name="sideEffects"></textarea>

    <label>Dosage</label>
    <textarea name="dosage"></textarea>

    <button type="submit">Update Medication</button>
</form>

<script>
document.getElementById("updateMedForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const form = e.target;
    const medId = "<%= medication._id %>";
    const csrf = "<%= csrfToken %>";

    const body = {
        name: form.name.value || undefined,
        description: form.description.value || undefined,
        sideEffects: form.sideEffects.value || undefined,
        dosage: form.dosage.value || undefined,
    };

    const res = await fetch(`/api/medications/${medId}`, {
        method: "PUT",
        credentials: "include",
        headers: {
            "Content-Type": "application/json",
            "CSRF-Token": csrf
        },
        body: JSON.stringify(body)
    });

    const json = await res.json();

    if (json.status === "success") {
        showNotify("Updated successfully!", "success");
    }
    else if (json.status === "already") {
        showNotify("Already updated!", "warning");
    }
    else {
        showNotify(json.message || "Update failed", "error");
    }
});
</script>
<div id="notify-box"
     style="
        display:none;
        position:fixed;
        top:20px;
        right:20px;
        z-index:9999;
        padding:15px;
        border-radius:8px;
        color:white;
        font-weight:bold;
        box-shadow:0 3px 10px rgba(0,0,0,0.3);
     ">
</div>

<script>
function showNotify(message, type="success") {
    const box = document.getElementById("notify-box");

    const colors = {
        success: "#28a745",
        error: "#dc3545",
        warning: "#ffc107"
    };

    box.style.background = colors[type] || colors.success;
    box.innerText = message;
    box.style.display = "block";

    setTimeout(() => {
        box.style.display = "none";
    }, 10000);
}
</script>
