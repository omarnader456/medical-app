<h1>Create Medication</h1>

<form id="MedicationForm">
  <input type="hidden" name="_csrf" value="<%= csrfToken %>">

  <label>Medication Name:
      <input type="text" name="name" required>
  </label><br>

  <label>Medication Description:
      <input type="text" name="description" required>
  </label><br>

  <label>Medication SideEffects:
      <input type="text" name="SideEffects" required>
  </label><br>
   <label>Medication Dosage:
      <input type="text" name="dosage" required>
  </label><br> 

  <button type="submit">Save & Route</button>
</form>

<div id="notify" style="
    display:none;
    padding:10px;
    margin-top:10px;
    color:white;
    background:green;
    border-radius:5px;">
</div>

<script>
document.getElementById("MedicationForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const csrf = '<%= csrfToken %>';

    const data = {
        name: e.target.name.value,
        description: e.target.description.value,
        sideEffects: e.target.sideEffects.value,
        dosage: e.target.dosage.value
    };

    const res = await fetch(`/api/doctor/medications`, {
        method: "POST",
        credentials: "include",
        headers: {
            "Content-Type": "application/json",
            "CSRF-Token": csrf
        },
        body: JSON.stringify(data)
    });

    const json = await res.json();

    if (res.ok) {
        showMsg("Medication created!", false);
        setTimeout(() => {
            window.location = "/doctor/medication";
        }, 2000);
    } else {
        showMsg(json.message || "Error", true);
    }
});

function showMsg(msg, error) {
    const box = document.getElementById("notify");
    box.style.display = "block";
    box.style.background = error ? "red" : "green";
    box.innerText = msg;

    setTimeout(() => {
        box.style.display = "none";
    }, 10000);
}
</script>